---
layout: post
title: cookie学习
keywords: cookie
categories : [Web]
tags : [Web]
---
 ＃ 先来说cookie。
 首先，为什么要有cookie
 先解释两个名词：客户端和服务器端。
 客户端：可以理解为你的浏览器
 服务端：姑且认为是高级PC吧。
 当客户端在发送一个请求并且得到返回信息之后，客户端和服务器端之间的网络连接就已经断开，在发送下一个请求时，服务器端无法确定这次请求和上次的请求是否来自同一个客户端。即，服务器不能“记住”用户，这是因为http协议是无状态的协议。而在web应用程序中，是经常需要记住每次请求的。为了让服务器知道不同的请求是否来自同一个客户端。于是出现了cookie和session。
其次，cookie是什么？
cookie是一个数据包，每次访问网站的时候浏览器都会将该网站的cookie发回给网站服务器，cookie不是只有一个，而是一个网站一个，它是你在某个网站上的唯一标识。cookie由服务器端生成。
以下java中使用cookie 的关键代码：

建立一个无生命周期的cookie，即随着浏览器的关闭即消失的cookie，代码如下
HttpServletRequest request  
HttpServletResponse response
Cookie cookie = new Cookie("cookiename","cookievalue");
response.addCookie(cookie);


下面建立一个有生命周期的cookie,可以设置他的生命周期
cookie = new Cookie("cookiename","cookievalue");

cookie.setMaxAge(3600);

//设置路径，这个路径即该工程下都可以访问该cookie 如果不设置路径，那么只有设置该cookie路径及其子路径可以访问

cookie.setPath("/");
response.addCookie(cookie);


下面介绍如何读取cookie，读取cookie代码如下
Cookie[] cookies = request.getCookies();//这样便可以获取一个cookie数组
for(Cookie cookie : cookies){
cookie.getName();// get the cookie name
cookie.getValue(); // get the cookie value
}


上面就是基本的读写cookie的操作。我们在实际中最好进行一下封装，比如增加一个cookie，我们关注的是cookie的name，value,生命周期，所以进行封装一个函数，当然还要传入一个response对象，addCookie()代码如下
/**
* 设置cookie
* @param response
* @param name  cookie名字
* @param value cookie值
* @param maxAge cookie生命周期  以秒为单位
*/
public static void addCookie(HttpServletResponse response,String name,String value,int maxAge){
Cookie cookie = new Cookie(name,value);
cookie.setPath("/");
if(maxAge>0)  cookie.setMaxAge(maxAge);
response.addCookie(cookie);
}


读取cookie的时候，为了方便我们的操作，我们希望封装一个函数，只要我们提供cookie的name，我们便可以获取cookie的value，带着这个想法，很容易想到将cookie封装到Map里面，于是进行下面的封装
/**
* 根据名字获取cookie
* @param request
* @param name cookie名字
* @return
*/
public static Cookie getCookieByName(HttpServletRequest request,String name){
Map<String,Cookie> cookieMap = ReadCookieMap(request);
if(cookieMap.containsKey(name)){
Cookie cookie = (Cookie)cookieMap.get(name);
return cookie;
}else{
return null;
}   
}



/**
* 将cookie封装到Map里面
* @param request
* @return
*/
private static Map<String,Cookie> ReadCookieMap(HttpServletRequest request){  
Map<String,Cookie> cookieMap = new HashMap<String,Cookie>();
Cookie[] cookies = request.getCookies();
if(null!=cookies){
for(Cookie cookie : cookies){
cookieMap.put(cookie.getName(), cookie);
}
}
return cookieMap;
}


